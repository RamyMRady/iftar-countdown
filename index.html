<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iftar Countdown - MCA Santa Clara</title>

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ™</text></svg>">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#667eea">
    <meta name="apple-mobile-web-app-title" content="Iftar Countdown">

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="Iftar Countdown - MCA Santa Clara">
    <meta property="og:description" content="Real-time countdown to Iftar and Suhoor times at Muslim Community Association, Santa Clara">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .location {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .iftar-time {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .iftar-time h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .iftar-time .time {
            font-size: 2em;
            font-weight: bold;
        }

        .countdown {
            margin: 30px 0;
        }

        .countdown h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .time-unit {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            min-width: 100px;
        }

        .time-unit .number {
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .time-unit .label {
            font-size: 0.9em;
            color: #666;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .date-info {
            color: #666;
            margin: 20px 0;
            font-size: 1.1em;
        }

        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #eee;
            color: #666;
        }

        .creator {
            font-size: 1.1em;
            color: #667eea;
            font-weight: bold;
            margin-top: 10px;
        }

        .audio-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .audio-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }

        .audio-btn:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        .audio-btn.active {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .mca-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }

        .mca-link:hover {
            text-decoration: underline;
        }

        .view-counter {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #666;
            font-size: 0.9em;
        }

        .view-counter strong {
            color: #667eea;
        }

        .share-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .share-btn:hover {
            transform: translateY(-2px);
        }

        .share-whatsapp {
            background: #25D366;
        }

        .share-twitter {
            background: #1DA1F2;
        }

        .share-facebook {
            background: #1877F2;
        }

        .share-copy {
            background: #666;
        }

        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1000;
        }

        .dark-mode-toggle:hover {
            transform: rotate(180deg);
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2d3561 0%, #3d2d52 100%);
        }

        body.dark-mode .container {
            background: #2a2a40;
            color: #e0e0e0;
        }

        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode h3 {
            color: #e0e0e0;
        }

        body.dark-mode .location,
        body.dark-mode .date-info {
            color: #b0b0b0;
        }

        body.dark-mode .time-unit {
            background: #1a1a2e;
            color: #e0e0e0;
        }

        body.dark-mode .time-unit .number {
            color: #8b9aee;
        }

        body.dark-mode .toggle-btn {
            background: #1a1a2e;
            color: #e0e0e0;
        }

        body.dark-mode .footer {
            border-top-color: #444;
            color: #b0b0b0;
        }

        body.dark-mode .view-counter {
            background: #1a1a2e;
            color: #b0b0b0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .volume-control {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .volume-control label {
            color: #667eea;
            font-weight: bold;
        }

        .volume-slider {
            width: 200px;
            height: 6px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
        }

        .volume-value {
            color: #667eea;
            font-weight: bold;
            min-width: 40px;
        }

        .toggle-controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .toggle-btn {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .loading {
            color: #666;
            font-style: italic;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .time-unit {
                min-width: 70px;
                padding: 12px;
            }

            .time-unit .number {
                font-size: 2em;
            }

            .time-unit .label {
                font-size: 0.8em;
            }

            .toggle-btn, .audio-btn, .share-btn {
                padding: 10px 14px;
                font-size: 0.85em;
            }

            .volume-slider {
                width: 150px;
            }

            .dark-mode-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1.2em;
            }

            select {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">ğŸŒ™</button>

    <div class="container">
        <h1 id="pageTitle">ğŸŒ™ Iftar Countdown</h1>
        <div class="location" id="mosqueLocation">Muslim Community Association<br>Santa Clara, California</div>

        <!-- Selectors -->
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin: 15px 0;">
            <select id="mosqueSelector" onchange="changeMosque()" style="padding: 8px; border-radius: 6px; border: 2px solid #667eea;">
                <option value="mca">MCA - Santa Clara</option>
                <option value="sbia">SBIA - San Jose</option>
                <option value="alnoor">Masjid Al-Noor - Santa Clara</option>
                <option value="mcc">MCC - Pleasanton</option>
            </select>
            <select id="langSelector" onchange="changeLanguage()" style="padding: 8px; border-radius: 6px; border: 2px solid #667eea;">
                <option value="en">English</option>
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="tr">TÃ¼rkÃ§e</option>
                <option value="ur">Ø§Ø±Ø¯Ùˆ</option>
            </select>
        </div>

        <div class="date-info" id="dateInfo">Loading...</div>

        <div class="toggle-controls">
            <button class="toggle-btn active" id="iftarBtn" onclick="switchCountdown('iftar')">â° Countdown to Iftar</button>
            <button class="toggle-btn" id="suhoorBtn" onclick="switchCountdown('suhoor')">â˜€ï¸ Countdown to Suhoor</button>
        </div>

        <div class="countdown">
            <h3 id="countdownTitle">Time Until Iftar</h3>
            <div class="timer">
                <div class="time-unit">
                    <span class="number" id="hours">0</span>
                    <span class="label">Hours</span>
                </div>
                <div class="time-unit">
                    <span class="number" id="minutes">0</span>
                    <span class="label">Minutes</span>
                </div>
                <div class="time-unit">
                    <span class="number" id="seconds">0</span>
                    <span class="label">Seconds</span>
                </div>
            </div>
        </div>

        <div class="iftar-time">
            <h2 id="prayerTimeTitle">Today's Iftar Time (Maghrib)</h2>
            <div class="time" id="prayerTime">--:--</div>
        </div>

        <div id="message"></div>

        <div class="audio-controls">
            <button class="audio-btn" id="azanBtn" onclick="toggleAudio('azan')">ğŸ•Œ Play Azan</button>
            <button class="audio-btn" id="cannonBtn" onclick="toggleAudio('cannon')">ğŸ’¥ Iftar Cannon (Ù…Ø¯ÙØ¹ Ø§Ù„Ø§ÙØ·Ø§Ø±)</button>
            <button class="audio-btn" id="rainBtn" onclick="toggleAudio('rain')">ğŸŒ§ï¸ Play Rain</button>
            <button class="audio-btn" id="stopBtn" onclick="stopAudio()" style="display: none;">â¸ï¸ Stop</button>
        </div>

        <div class="volume-control">
            <label for="volumeSlider">ğŸ”Š Volume:</label>
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="70" oninput="updateVolume(this.value)">
            <span class="volume-value" id="volumeValue">70%</span>
        </div>

        <!-- Dua and Export buttons -->
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 20px 0;">
            <button class="audio-btn" onclick="showDua()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">ğŸ“¿ Show Dua</button>
            <button class="audio-btn" onclick="exportToCalendar()" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);">ğŸ“… Export to Calendar</button>
        </div>

        <!-- Dua display -->
        <div id="duaDisplay" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 20px 0;"></div>

        <div class="footer">
            <div>Ramadan Mubarak! ğŸŒ™</div>
            <div class="creator">Created by Ramy Rady</div>
            <div style="margin-top: 10px;">
                <a href="https://www.mcabayarea.org" target="_blank" class="mca-link">Visit MCA Bay Area â†’</a>
            </div>

            <div class="share-buttons">
                <a href="#" class="share-btn share-whatsapp" onclick="shareWhatsApp(event)">ğŸ“± WhatsApp</a>
                <a href="#" class="share-btn share-twitter" onclick="shareTwitter(event)">ğŸ¦ Twitter</a>
                <a href="#" class="share-btn share-facebook" onclick="shareFacebook(event)">ğŸ‘ Facebook</a>
                <button class="share-btn share-copy" onclick="copyLink()">ğŸ”— Copy Link</button>
            </div>

            <div class="view-counter">
                ğŸ‘ï¸ Page Views: <strong id="viewCount">Loading...</strong>
            </div>
        </div>
    </div>

    <audio id="azanAudio" loop>
        <source src="azan.mp4" type="audio/mp4">
    </audio>
    <audio id="cannonAudio">
        <source src="cannon.mp3" type="audio/mpeg">
    </audio>
    <audio id="rainAudio" loop>
        <source src="https://cdn.pixabay.com/audio/2022/05/13/audio_257112ce99.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Mosque data for Bay Area
        const mosques = {
            mca: {
                name: 'Muslim Community Association',
                city: 'Santa Clara',
                lat: 37.3541,
                lng: -121.9552,
                adjustment: 3 // minutes to add to Maghrib
            },
            sbia: {
                name: 'South Bay Islamic Association',
                city: 'San Jose',
                lat: 37.2502,
                lng: -121.8634,
                adjustment: 3
            },
            alnoor: {
                name: 'Masjid Al-Noor',
                city: 'Santa Clara',
                lat: 37.3688,
                lng: -121.9644,
                adjustment: 3
            },
            mcc: {
                name: 'Muslim Community Center',
                city: 'Pleasanton',
                lat: 37.6624,
                lng: -121.8747,
                adjustment: 3
            }
        };

        // Get selected mosque from localStorage or default to MCA
        let currentMosque = localStorage.getItem('selectedMosque') || 'mca';
        const mosqueData = mosques[currentMosque];

        // Coordinates from selected mosque
        const LATITUDE = mosqueData.lat;
        const LONGITUDE = mosqueData.lng;

        // Duas
        const duas = {
            iftar: {
                breaking: {
                    arabic: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§ÙÙ†ÙÙ‘Ù‰ Ù„ÙÙƒÙ ØµÙÙ…Ù’ØªÙ ÙˆÙØ¨ÙÙƒÙ Ø§Ù…Ù†Ù’ØªÙ ÙˆÙØ¹ÙÙ„ÙŠÙ’ÙƒÙ ØªÙÙˆÙÙƒÙ‘Ù„ØªÙ ÙˆÙ Ø¹ÙÙ„Ù‰ Ø±ÙØ²Ù’Ù‚ÙÙƒÙ Ø§ÙÙÙ’Ø·ÙØ±Ù’ØªÙ',
                    transliteration: 'Allahumma inni laka sumtu wa bika aamantu wa alayka tawakkaltu wa ala rizq-ika-aftartu',
                    english: 'O Allah! I fasted for You and I believe in You and I put my trust in You and I break my fast with Your sustenance'
                },
                after: {
                    arabic: 'Ø°ÙÙ‡ÙØ¨Ù Ø§Ù„Ø¸ÙÙ‘Ù…ÙØ£Ù ÙˆÙØ§Ø¨Ù’ØªÙÙ„ÙÙ‘ØªÙ Ø§Ù„Ù’Ø¹ÙØ±ÙÙˆÙ‚Ù ÙˆÙØ«ÙØ¨ÙØªÙ Ø§Ù„Ø£ÙØ¬Ù’Ø±Ù Ø¥ÙÙ†Ù’ Ø´ÙØ§Ø¡Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù',
                    transliteration: 'Dhahabaz Zama\'u wab tal latil uruqoo wa thabbatal ajru inshaAllah',
                    english: 'Thirst has gone, the arteries are moist, and the reward is sure, if Allah wills'
                },
                group: {
                    arabic: 'Ø£ÙØ·Ø± Ø¹Ù†Ø¯ÙƒÙ… Ø§Ù„ØµØ§Ø¦Ù…ÙˆÙ† ØŒ ÙˆØ£ÙƒÙ„ Ø·Ø¹Ø§Ù…ÙƒÙ… Ø§Ù„Ø£Ø¨Ø±Ø§Ø±ØŒ ÙˆØµÙ„Øª Ø¹Ù„ÙŠÙƒÙ… Ø§Ù„Ù…Ù„Ø§Ø¦ÙƒØ©',
                    transliteration: 'aftara indakum as-saa\'imoon, wa akala ta\'aamakum al-abraar, wa sallat alaikum al-malaa\'ikah',
                    english: 'May the fasting people break fast at your place, and may the pious eat from your food, and may the angels pray for you'
                }
            },
            suhoor: {
                before: {
                    arabic: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙØ§Ø±ÙÙƒÙ’ Ù„ÙÙ†ÙØ§ ÙÙÙŠÙ‡Ù ÙˆÙØ£ÙØ·Ù’Ø¹ÙÙ…Ù’Ù†ÙØ§ Ø®ÙÙŠÙ’Ø±Ø§Ù‹ Ù…ÙÙ†Ù’Ù‡Ù',
                    transliteration: 'Allaahumma baarik lanaa feehi wa \'at\'imnaa khayran minhu',
                    english: 'O Allah, bless us in it and provide us with better than it'
                },
                after: {
                    arabic: 'ÙˆÙØ¨ÙØµÙÙˆÙ’Ù…Ù ØºÙØ¯Ù Ù†ÙÙ‘ÙˆÙÙŠÙ’ØªÙ Ù…ÙÙ†Ù’ Ø´ÙÙ‡Ù’Ø±Ù Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù',
                    transliteration: 'Wabi saumi gadin nawaitu min shahri ramadan',
                    english: 'I Intend to keep the fast of tomorrow in the month of Ramadan'
                }
            },
            taraweeh: {
                arabic: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø°ÙÙŠ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙØ§Ù„Ù’Ù…ÙÙ„ÙØ§ÙƒÙÙˆØªÙ Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø°ÙÙŠ Ø§Ù„Ù’Ø¹ÙØ²ÙÙ‘Ø©Ù ÙˆÙØ§Ù„Ù’Ø¬ÙØ¨ÙØ±ÙÙˆØªÙ ÙˆÙØ§Ù„Ù’ÙƒÙØ¨Ù’Ø±ÙÙŠÙØ§Ø¡Ù ÙˆÙØ§Ù„Ù’Ø¹ÙØ¸ÙÙ…ÙØ©ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙŠÙØ§Ø©Ù Ø§Ù„ÙÙ‘ØªÙÙŠ Ù„ÙØ§ ÙŠÙÙ†ÙØ§Ù…Ù ÙˆÙÙ„ÙØ§ ÙŠÙÙ…ÙÙˆØªÙØŒ Ø³ÙØ¨ÙÙ‘ÙˆØ­ÙŒ Ù‚ÙØ¯ÙÙ‘ÙˆØ³ÙŒ Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ ÙˆÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ù…ÙÙ„ÙØ§Ø¦ÙÙƒÙØ©Ù ÙˆÙØ§Ù„Ø±ÙÙ‘ÙˆØ­Ù',
                transliteration: 'Subhana zil mulki wal malakooti subhana zil izzati wal jabaroot wal kibriyaai wal jabaroot. Wal azamati wal hayati allati la yanamu wala yamoot. Subboohun qud\'doosur-rabuna warabbul malaa\'ikati warruh',
                english: 'Glory be to Allah, the Possessor of might, dominion, magnificence, and the manifest dominion. He is the Owner of the kingdom of the earth and the heavens. He is free from any imperfection, and none is worthy of worship except Him. He is the Lord of the angels and the Spirit'
            }
        };

        // Translations
        const translations = {
            en: {
                title: 'Iftar Countdown',
                location: mosqueData.name + '<br>' + mosqueData.city + ', California',
                countdownToIftar: 'Time Until Iftar',
                countdownToSuhoor: 'Time Until Suhoor',
                todayIftar: "Today's Iftar Time (Maghrib)",
                tomorrowIftar: "Tomorrow's Iftar Time (Maghrib)",
                todaySuhoor: "Today's Suhoor Ends (Fajr)",
                tomorrowSuhoor: "Tomorrow's Suhoor Ends (Fajr)",
                buttonIftar: 'â° Countdown to Iftar',
                buttonSuhoor: 'â˜€ï¸ Countdown to Suhoor',
                hours: 'Hours',
                minutes: 'Minutes',
                seconds: 'Seconds',
                playAzan: 'ğŸ•Œ Play Azan',
                playCannon: 'ğŸ’¥ Iftar Cannon (Ù…Ø¯ÙØ¹ Ø§Ù„Ø§ÙØ·Ø§Ø±)',
                playRain: 'ğŸŒ§ï¸ Play Rain',
                stop: 'â¸ï¸ Stop',
                volume: 'ğŸ”Š Volume:',
                shareWhatsApp: 'ğŸ“± WhatsApp',
                shareTwitter: 'ğŸ¦ Twitter',
                shareFacebook: 'ğŸ‘ Facebook',
                shareCopy: 'ğŸ”— Copy Link',
                pageViews: 'ğŸ‘ï¸ Page Views:',
                ramadanMubarak: 'Ramadan Mubarak! ğŸŒ™',
                createdBy: 'Created by Ramy Rady',
                visitMosque: 'Visit Website â†’',
                showDua: 'ğŸ“¿ Show Dua',
                exportCalendar: 'ğŸ“… Export to Calendar',
                selectMosque: 'Select Mosque:',
                selectLanguage: 'Language:'
            },
            ar: {
                title: 'Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¥ÙØ·Ø§Ø±',
                location: mosqueData.name + '<br>' + mosqueData.city + 'ØŒ ÙƒØ§Ù„ÙŠÙÙˆØ±Ù†ÙŠØ§',
                countdownToIftar: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø¥ÙØ·Ø§Ø±',
                countdownToSuhoor: 'Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø³Ø­ÙˆØ±',
                todayIftar: 'ÙˆÙ‚Øª Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø§Ù„ÙŠÙˆÙ… (Ø§Ù„Ù…ØºØ±Ø¨)',
                tomorrowIftar: 'ÙˆÙ‚Øª Ø§Ù„Ø¥ÙØ·Ø§Ø± ØºØ¯Ø§Ù‹ (Ø§Ù„Ù…ØºØ±Ø¨)',
                todaySuhoor: 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø­ÙˆØ± Ø§Ù„ÙŠÙˆÙ… (Ø§Ù„ÙØ¬Ø±)',
                tomorrowSuhoor: 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³Ø­ÙˆØ± ØºØ¯Ø§Ù‹ (Ø§Ù„ÙØ¬Ø±)',
                buttonIftar: 'â° Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¥ÙØ·Ø§Ø±',
                buttonSuhoor: 'â˜€ï¸ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø³Ø­ÙˆØ±',
                hours: 'Ø³Ø§Ø¹Ø§Øª',
                minutes: 'Ø¯Ù‚Ø§Ø¦Ù‚',
                seconds: 'Ø«ÙˆØ§Ù†ÙŠ',
                playAzan: 'ğŸ•Œ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø°Ø§Ù†',
                playCannon: 'ğŸ’¥ Ù…Ø¯ÙØ¹ Ø§Ù„Ø¥ÙØ·Ø§Ø±',
                playRain: 'ğŸŒ§ï¸ ØµÙˆØª Ø§Ù„Ù…Ø·Ø±',
                stop: 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù',
                volume: 'ğŸ”Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª:',
                shareWhatsApp: 'ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨',
                shareTwitter: 'ğŸ¦ ØªÙˆÙŠØªØ±',
                shareFacebook: 'ğŸ‘ ÙÙŠØ³Ø¨ÙˆÙƒ',
                shareCopy: 'ğŸ”— Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·',
                pageViews: 'ğŸ‘ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª:',
                ramadanMubarak: 'Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ùƒ! ğŸŒ™',
                createdBy: 'Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ù…ÙŠ Ø±Ø§Ø¯ÙŠ',
                visitMosque: 'Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ â†’',
                showDua: 'ğŸ“¿ Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡',
                exportCalendar: 'ğŸ“… ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…',
                selectMosque: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø¬Ø¯:',
                selectLanguage: 'Ø§Ù„Ù„ØºØ©:'
            },
            tr: {
                title: 'Ä°ftar Geri SayÄ±mÄ±',
                location: mosqueData.name + '<br>' + mosqueData.city + ', Kaliforniya',
                countdownToIftar: 'Ä°ftara Kalan SÃ¼re',
                countdownToSuhoor: 'Sahura Kalan SÃ¼re',
                todayIftar: "BugÃ¼nÃ¼n Ä°ftar Saati (AkÅŸam)",
                tomorrowIftar: "YarÄ±nÄ±n Ä°ftar Saati (AkÅŸam)",
                todaySuhoor: "BugÃ¼nÃ¼n Sahur BitiÅŸi (Sabah)",
                tomorrowSuhoor: "YarÄ±nÄ±n Sahur BitiÅŸi (Sabah)",
                buttonIftar: 'â° Ä°ftar Geri SayÄ±mÄ±',
                buttonSuhoor: 'â˜€ï¸ Sahur Geri SayÄ±mÄ±',
                hours: 'Saat',
                minutes: 'Dakika',
                seconds: 'Saniye',
                playAzan: 'ğŸ•Œ Ezan Ã‡al',
                playCannon: 'ğŸ’¥ Ä°ftar Topu (Ù…Ø¯ÙØ¹ Ø§Ù„Ø§ÙØ·Ø§Ø±)',
                playRain: 'ğŸŒ§ï¸ YaÄŸmur Sesi',
                stop: 'â¸ï¸ Durdur',
                volume: 'ğŸ”Š Ses:',
                shareWhatsApp: 'ğŸ“± WhatsApp',
                shareTwitter: 'ğŸ¦ Twitter',
                shareFacebook: 'ğŸ‘ Facebook',
                shareCopy: 'ğŸ”— BaÄŸlantÄ±yÄ± Kopyala',
                pageViews: 'ğŸ‘ï¸ GÃ¶rÃ¼ntÃ¼lenme:',
                ramadanMubarak: 'Ramazan MÃ¼barek! ğŸŒ™',
                createdBy: 'Ramy Rady tarafÄ±ndan',
                visitMosque: 'Web Sitesini Ziyaret Et â†’',
                showDua: 'ğŸ“¿ DuayÄ± GÃ¶ster',
                exportCalendar: 'ğŸ“… Takvime Aktar',
                selectMosque: 'Cami SeÃ§:',
                selectLanguage: 'Dil:'
            },
            ur: {
                title: 'Ø§ÙØ·Ø§Ø± Ú©Ø§Ø¤Ù†Ù¹ ÚˆØ§Ø¤Ù†',
                location: mosqueData.name + '<br>' + mosqueData.city + 'ØŒ Ú©ÛŒÙ„ÛŒÙÙˆØ±Ù†ÛŒØ§',
                countdownToIftar: 'Ø§ÙØ·Ø§Ø± ØªÚ© Ø¨Ø§Ù‚ÛŒ ÙˆÙ‚Øª',
                countdownToSuhoor: 'Ø³Ø­Ø±ÛŒ ØªÚ© Ø¨Ø§Ù‚ÛŒ ÙˆÙ‚Øª',
                todayIftar: 'Ø¢Ø¬ Ú©Ø§ Ø§ÙØ·Ø§Ø± Ú©Ø§ ÙˆÙ‚Øª (Ù…ØºØ±Ø¨)',
                tomorrowIftar: 'Ú©Ù„ Ú©Ø§ Ø§ÙØ·Ø§Ø± Ú©Ø§ ÙˆÙ‚Øª (Ù…ØºØ±Ø¨)',
                todaySuhoor: 'Ø¢Ø¬ Ø³Ø­Ø±ÛŒ Ø®ØªÙ… (ÙØ¬Ø±)',
                tomorrowSuhoor: 'Ú©Ù„ Ø³Ø­Ø±ÛŒ Ø®ØªÙ… (ÙØ¬Ø±)',
                buttonIftar: 'â° Ø§ÙØ·Ø§Ø± Ú©Ø§Ø¤Ù†Ù¹ ÚˆØ§Ø¤Ù†',
                buttonSuhoor: 'â˜€ï¸ Ø³Ø­Ø±ÛŒ Ú©Ø§Ø¤Ù†Ù¹ ÚˆØ§Ø¤Ù†',
                hours: 'Ú¯Ú¾Ù†Ù¹Û’',
                minutes: 'Ù…Ù†Ù¹',
                seconds: 'Ø³ÛŒÚ©Ù†Úˆ',
                playAzan: 'ğŸ•Œ Ø§Ø°Ø§Ù† Ú†Ù„Ø§Ø¦ÛŒÚº',
                playCannon: 'ğŸ’¥ Ø§ÙØ·Ø§Ø± ØªÙˆÙ¾ (Ù…Ø¯ÙØ¹ Ø§Ù„Ø§ÙØ·Ø§Ø±)',
                playRain: 'ğŸŒ§ï¸ Ø¨Ø§Ø±Ø´ Ú©ÛŒ Ø¢ÙˆØ§Ø²',
                stop: 'â¸ï¸ Ø±Ú©ÛŒÚº',
                volume: 'ğŸ”Š Ø¢ÙˆØ§Ø²:',
                shareWhatsApp: 'ğŸ“± ÙˆØ§Ù¹Ø³ Ø§ÛŒÙ¾',
                shareTwitter: 'ğŸ¦ Ù¹ÙˆÛŒÙ¹Ø±',
                shareFacebook: 'ğŸ‘ ÙÛŒØ³ Ø¨Ú©',
                shareCopy: 'ğŸ”— Ù„Ù†Ú© Ú©Ø§Ù¾ÛŒ Ú©Ø±ÛŒÚº',
                pageViews: 'ğŸ‘ï¸ Ù…Ù„Ø§Ø­Ø¸Ø§Øª:',
                ramadanMubarak: 'Ø±Ù…Ø¶Ø§Ù† Ù…Ø¨Ø§Ø±Ú©! ğŸŒ™',
                createdBy: 'Ø±Ø§Ù…ÛŒ Ø±Ø§Ø¯ÛŒ Ú©ÛŒ Ø·Ø±Ù Ø³Û’',
                visitMosque: 'ÙˆÛŒØ¨ Ø³Ø§Ø¦Ù¹ Ø¯ÛŒÚ©Ú¾ÛŒÚº â†’',
                showDua: 'ğŸ“¿ Ø¯Ø¹Ø§ Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº',
                exportCalendar: 'ğŸ“… Ú©ÛŒÙ„Ù†ÚˆØ± Ù…ÛŒÚº Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº',
                selectMosque: 'Ù…Ø³Ø¬Ø¯ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº:',
                selectLanguage: 'Ø²Ø¨Ø§Ù†:'
            }
        };

        // Current language
        let currentLang = localStorage.getItem('selectedLanguage') || 'en';
        const t = translations[currentLang];

        let iftarTimeToday = null;
        let suhoorTimeToday = null;
        let countdownInterval = null;
        let currentMode = 'iftar'; // 'iftar' or 'suhoor'

        // Set initial volume
        const azanAudio = document.getElementById('azanAudio');
        const cannonAudio = document.getElementById('cannonAudio');
        const rainAudio = document.getElementById('rainAudio');
        azanAudio.volume = 0.7;
        cannonAudio.volume = 0.7;
        rainAudio.volume = 0.7;

        // Update volume for all audio elements
        function updateVolume(value) {
            const volume = value / 100;
            azanAudio.volume = volume;
            cannonAudio.volume = volume;
            rainAudio.volume = volume;
            document.getElementById('volumeValue').textContent = value + '%';
        }

        // Format time from 24hr to 12hr format
        function formatTime(time24) {
            const [hours, minutes] = time24.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes} ${ampm}`;
        }

        // Fetch prayer times from Aladhan API
        async function fetchPrayerTimes() {
            try {
                const today = new Date();
                const timestamp = Math.floor(today.getTime() / 1000);

                const response = await fetch(
                    `https://api.aladhan.com/v1/timings/${timestamp}?latitude=${LATITUDE}&longitude=${LONGITUDE}&method=2`
                );

                if (!response.ok) throw new Error('Failed to fetch prayer times');

                const data = await response.json();
                const timings = data.data.timings;
                const date = data.data.date;

                // Get Maghrib time (iftar time) and add 3 minutes to match MCA times
                const maghribTime = timings.Maghrib;
                const [hours, mins] = maghribTime.split(':');
                const adjustedDate = new Date();
                adjustedDate.setHours(parseInt(hours), parseInt(mins) + 3, 0, 0);
                const adjustedHours = adjustedDate.getHours().toString().padStart(2, '0');
                const adjustedMins = adjustedDate.getMinutes().toString().padStart(2, '0');
                iftarTimeToday = `${adjustedHours}:${adjustedMins}`;

                // Get Fajr time (suhoor ends at Fajr)
                const fajrTime = timings.Fajr;
                suhoorTimeToday = fajrTime;

                // Determine which countdown to show by default
                const now = new Date();
                const currentHour = now.getHours();

                // Simple logic: if current time is after 12 PM (noon), show suhoor countdown
                // Since iftar is in evening (around 5-6 PM) and suhoor is early morning (4-6 AM),
                // anyone visiting after noon until early morning should see suhoor countdown

                console.log('=== AUTO-SELECT DEBUG ===');
                console.log('Current hour:', currentHour);
                console.log('Iftar time:', iftarTimeToday);
                console.log('Suhoor time:', suhoorTimeToday);

                const [iHours, iMins] = iftarTimeToday.split(':');
                const iftarHour = parseInt(iHours);

                const [sHours, sMins] = suhoorTimeToday.split(':');
                const suhoorHour = parseInt(sHours);

                console.log('Iftar hour:', iftarHour);
                console.log('Suhoor hour:', suhoorHour);

                // If current time is after iftar time OR before suhoor time, show suhoor
                // (between evening iftar and early morning suhoor)
                if (currentHour >= iftarHour || currentHour < suhoorHour) {
                    console.log('âœ… AUTO-SELECTING: Suhoor (evening/night time)');
                    currentMode = 'suhoor';
                    switchCountdown('suhoor');
                } else {
                    console.log('âœ… AUTO-SELECTING: Iftar (daytime)');
                    currentMode = 'iftar';
                    document.getElementById('prayerTime').textContent = formatTime(iftarTimeToday);
                    startCountdown();
                }

                // Update date info
                const hijriDate = date.hijri;
                const gregorianDate = date.gregorian;
                document.getElementById('dateInfo').textContent =
                    `${gregorianDate.weekday.en}, ${gregorianDate.day} ${gregorianDate.month.en} ${gregorianDate.year} | ${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year}`;

            } catch (error) {
                console.error('Error fetching prayer times:', error);
                document.getElementById('message').innerHTML =
                    '<div class="error">Unable to fetch prayer times. Please check your internet connection and refresh the page.</div>';
            }
        }

        // Start countdown timer
        function startCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);

            countdownInterval = setInterval(() => {
                const now = new Date();
                let targetDate;

                if (currentMode === 'iftar') {
                    // Parse iftar time
                    const [hours, minutes] = iftarTimeToday.split(':');
                    targetDate = new Date();
                    targetDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                    // If iftar has passed today, target tomorrow's iftar
                    if (now > targetDate) {
                        targetDate.setDate(targetDate.getDate() + 1);
                    }
                } else {
                    // Suhoor mode - countdown to Fajr
                    const [hours, minutes] = suhoorTimeToday.split(':');
                    targetDate = new Date();
                    targetDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                    // If suhoor time has passed today, target tomorrow's suhoor
                    if (now > targetDate) {
                        targetDate.setDate(targetDate.getDate() + 1);
                    }
                }

                // Calculate time difference
                const diff = targetDate - now;
                const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
                const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const secondsLeft = Math.floor((diff % (1000 * 60)) / 1000);

                // Update display
                document.getElementById('hours').textContent = hoursLeft;
                document.getElementById('minutes').textContent = minutesLeft;
                document.getElementById('seconds').textContent = secondsLeft;
            }, 1000);
        }

        // Switch between iftar and suhoor countdown
        function switchCountdown(mode) {
            currentMode = mode;
            const iftarBtn = document.getElementById('iftarBtn');
            const suhoorBtn = document.getElementById('suhoorBtn');
            const countdownTitle = document.getElementById('countdownTitle');
            const prayerTimeTitle = document.getElementById('prayerTimeTitle');
            const prayerTime = document.getElementById('prayerTime');

            document.getElementById('message').innerHTML = '';

            const now = new Date();

            if (mode === 'iftar') {
                iftarBtn.classList.add('active');
                suhoorBtn.classList.remove('active');
                countdownTitle.textContent = 'Time Until Iftar';

                // Check if iftar has passed today
                const [hours, minutes] = iftarTimeToday.split(':');
                const iftarDate = new Date();
                iftarDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                if (now > iftarDate) {
                    prayerTimeTitle.textContent = "Tomorrow's Iftar Time (Maghrib)";
                } else {
                    prayerTimeTitle.textContent = "Today's Iftar Time (Maghrib)";
                }
                prayerTime.textContent = formatTime(iftarTimeToday);
            } else {
                iftarBtn.classList.remove('active');
                suhoorBtn.classList.add('active');
                countdownTitle.textContent = 'Time Until Suhoor';

                // Check if suhoor has passed today
                const [hours, minutes] = suhoorTimeToday.split(':');
                const suhoorDate = new Date();
                suhoorDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);

                if (now > suhoorDate) {
                    prayerTimeTitle.textContent = "Tomorrow's Suhoor Ends (Fajr)";
                } else {
                    prayerTimeTitle.textContent = "Today's Suhoor Ends (Fajr)";
                }
                prayerTime.textContent = formatTime(suhoorTimeToday);
            }

            startCountdown();
        }

        // Initialize on page load
        fetchPrayerTimes();

        // Refresh prayer times at midnight every day
        function scheduleNextDayRefresh() {
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 1, 0); // 1 second after midnight

            const timeUntilMidnight = tomorrow - now;
            setTimeout(() => {
                fetchPrayerTimes();
                scheduleNextDayRefresh(); // Schedule next refresh
            }, timeUntilMidnight);
        }

        scheduleNextDayRefresh();

        // Simple view counter using an external API
        async function updateViewCounter() {
            try {
                // Using countapi.xyz - a free, simple counter API
                const response = await fetch('https://api.countapi.xyz/hit/ramymrady-iftar-countdown/visits');
                const data = await response.json();
                document.getElementById('viewCount').textContent = data.value.toLocaleString();
            } catch (error) {
                // Fallback to localStorage if API fails
                let views = parseInt(localStorage.getItem('pageViews') || '0');
                views++;
                localStorage.setItem('pageViews', views);
                document.getElementById('viewCount').textContent = views.toLocaleString() + ' (local)';
            }
        }

        // Call view counter on page load
        updateViewCounter();

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            document.querySelector('.dark-mode-toggle').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            document.querySelector('.dark-mode-toggle').textContent = 'â˜€ï¸';
        }

        // Social sharing functions
        function shareWhatsApp(e) {
            e.preventDefault();
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Check out this Iftar countdown timer for MCA Santa Clara! ğŸŒ™');
            window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
        }

        function shareTwitter(e) {
            e.preventDefault();
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Iftar countdown timer for MCA Santa Clara ğŸŒ™');
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
        }

        function shareFacebook(e) {
            e.preventDefault();
            const url = encodeURIComponent(window.location.href);

            // Check if running locally
            if (window.location.protocol === 'file:') {
                alert('Facebook sharing will work once the site is live on GitHub Pages!\n\nLink to share: https://ramymrady.github.io/iftar-countdown/');
                return;
            }

            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }).catch(() => {
                alert('Link: ' + window.location.href);
            });
        }

        // Notification when countdown reaches zero (only at actual prayer time, not for tomorrow's countdown)
        let hasNotified = false;
        let lastNotificationDate = null;

        function checkCountdownZero() {
            const hours = parseInt(document.getElementById('hours').textContent);
            const minutes = parseInt(document.getElementById('minutes').textContent);
            const seconds = parseInt(document.getElementById('seconds').textContent);

            if (hours === 0 && minutes === 0 && seconds <= 1 && !hasNotified) {
                // Check if we're at the actual prayer time (not counting down to tomorrow)
                const now = new Date();

                if (currentMode === 'iftar') {
                    const [iHours, iMins] = iftarTimeToday.split(':');
                    const iftarDate = new Date();
                    iftarDate.setHours(parseInt(iHours), parseInt(iMins), 0, 0);

                    // Only notify if we're within 2 minutes of actual iftar time (not tomorrow's)
                    const timeDiff = Math.abs(now - iftarDate);
                    if (timeDiff > 120000) return; // More than 2 minutes away, skip
                } else {
                    const [sHours, sMins] = suhoorTimeToday.split(':');
                    const suhoorDate = new Date();
                    suhoorDate.setHours(parseInt(sHours), parseInt(sMins), 0, 0);

                    // Only notify if we're within 2 minutes of actual suhoor time (not tomorrow's)
                    const timeDiff = Math.abs(now - suhoorDate);
                    if (timeDiff > 120000) return; // More than 2 minutes away, skip
                }

                // Check if we already notified today
                const today = now.toDateString();
                if (lastNotificationDate === today && currentMode === 'iftar') return;
                if (lastNotificationDate === today && currentMode === 'suhoor') return;

                hasNotified = true;
                lastNotificationDate = today;

                // Play azan automatically
                const azanAudio = document.getElementById('azanAudio');
                azanAudio.play().catch(() => {
                    console.log('Auto-play blocked by browser');
                });

                // Show notification
                const message = currentMode === 'iftar' ? 'ğŸŒ™ Time for Iftar! ğŸŒ™' : 'â˜€ï¸ Time for Suhoor! â˜€ï¸';
                document.getElementById('message').innerHTML =
                    `<div style="color: #48bb78; font-size: 1.5em; font-weight: bold; margin: 20px 0; animation: pulse 1s infinite;">${message}</div>`;

                // Request notification permission and show
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Iftar Countdown', {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸŒ™</text></svg>'
                    });
                } else if ('Notification' in window && Notification.permission !== 'denied') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            new Notification('Iftar Countdown', {
                                body: message,
                                icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸŒ™</text></svg>'
                            });
                        }
                    });
                }

                // Clear message after 30 seconds
                setTimeout(() => {
                    document.getElementById('message').innerHTML = '';
                }, 30000);

                // Reset notification flag after 2 minutes
                setTimeout(() => {
                    hasNotified = false;
                }, 120000);
            }
        }

        // Check every second for countdown zero
        setInterval(checkCountdownZero, 1000);

        // Request notification permission on first interaction
        document.addEventListener('click', function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            document.removeEventListener('click', requestNotificationPermission);
        }, { once: true });

        // Audio control functions
        let currentAudio = null;

        function toggleAudio(type) {
            const azanAudio = document.getElementById('azanAudio');
            const cannonAudio = document.getElementById('cannonAudio');
            const rainAudio = document.getElementById('rainAudio');
            const azanBtn = document.getElementById('azanBtn');
            const cannonBtn = document.getElementById('cannonBtn');
            const rainBtn = document.getElementById('rainBtn');
            const stopBtn = document.getElementById('stopBtn');

            // Show cannon info on first click
            if (type === 'cannon' && !localStorage.getItem('cannonInfoShown')) {
                const message = `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; text-align: left;">
                        <h3 style="color: white; margin-bottom: 10px;">ğŸ’¥ Iftar Cannons (Midfaa Iftar)</h3>
                        <p style="line-height: 1.6; margin-bottom: 10px;">
                            A traditional practice dating back to the Ottoman era to signal the end of the daily fast, Iftar cannons are still used in several countries during Ramadan 2026.
                        </p>
                        <p style="line-height: 1.6; margin: 0;">
                            <strong>Key locations include:</strong> UAE (Dubai, Abu Dhabi, Sharjah), Saudi Arabia (Mecca, Jeddah, Medina), Qatar, Bahrain, Kuwait, Jordan, Egypt, and Bosnia and Herzegovina.
                        </p>
                        <button onclick="this.parentElement.remove()" style="margin-top: 15px; padding: 8px 16px; background: white; color: #667eea; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">Got it!</button>
                    </div>
                `;
                document.getElementById('message').innerHTML = message;
                localStorage.setItem('cannonInfoShown', 'true');
            }

            // Stop any currently playing audio
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }

            // Reset button states
            azanBtn.classList.remove('active');
            cannonBtn.classList.remove('active');
            rainBtn.classList.remove('active');

            // Play selected audio
            if (type === 'azan') {
                azanAudio.play();
                currentAudio = azanAudio;
                azanBtn.classList.add('active');
                stopBtn.style.display = 'inline-block';
            } else if (type === 'cannon') {
                cannonAudio.play();
                currentAudio = cannonAudio;
                cannonBtn.classList.add('active');
                stopBtn.style.display = 'inline-block';
            } else if (type === 'rain') {
                rainAudio.play();
                currentAudio = rainAudio;
                rainBtn.classList.add('active');
                stopBtn.style.display = 'inline-block';
            }
        }

        function stopAudio() {
            const azanBtn = document.getElementById('azanBtn');
            const cannonBtn = document.getElementById('cannonBtn');
            const rainBtn = document.getElementById('rainBtn');
            const stopBtn = document.getElementById('stopBtn');

            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }

            azanBtn.classList.remove('active');
            cannonBtn.classList.remove('active');
            rainBtn.classList.remove('active');
            stopBtn.style.display = 'none';
        }

        // Show Dua
        function showDua() {
            const duaDisplay = document.getElementById('duaDisplay');

            if (duaDisplay.style.display === 'none') {
                let duaHTML = '';

                if (currentMode === 'iftar') {
                    duaHTML = `
                        <h3 style="color: #667eea; margin-bottom: 20px;">Dua for Iftar</h3>

                        <div style="margin-bottom: 25px; padding: 15px; background: white; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">When Breaking Fast:</h4>
                            <div style="font-size: 1.3em; margin-bottom: 8px; direction: rtl;">${duas.iftar.breaking.arabic}</div>
                            <div style="font-style: italic; color: #666; margin-bottom: 8px;">${duas.iftar.breaking.transliteration}</div>
                            <div style="color: #333;">${duas.iftar.breaking.english}</div>
                        </div>

                        <div style="margin-bottom: 25px; padding: 15px; background: white; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">After Breaking Fast:</h4>
                            <div style="font-size: 1.3em; margin-bottom: 8px; direction: rtl;">${duas.iftar.after.arabic}</div>
                            <div style="font-style: italic; color: #666; margin-bottom: 8px;">${duas.iftar.after.transliteration}</div>
                            <div style="color: #333;">${duas.iftar.after.english}</div>
                        </div>

                        <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">When Breaking Fast with a Group:</h4>
                            <div style="font-size: 1.3em; margin-bottom: 8px; direction: rtl;">${duas.iftar.group.arabic}</div>
                            <div style="font-style: italic; color: #666; margin-bottom: 8px;">${duas.iftar.group.transliteration}</div>
                            <div style="color: #333;">${duas.iftar.group.english}</div>
                        </div>
                    `;
                } else {
                    duaHTML = `
                        <h3 style="color: #667eea; margin-bottom: 20px;">Dua for Suhoor</h3>

                        <div style="margin-bottom: 25px; padding: 15px; background: white; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">Before Suhoor:</h4>
                            <div style="font-size: 1.3em; margin-bottom: 8px; direction: rtl;">${duas.suhoor.before.arabic}</div>
                            <div style="font-style: italic; color: #666; margin-bottom: 8px;">${duas.suhoor.before.transliteration}</div>
                            <div style="color: #333;">${duas.suhoor.before.english}</div>
                        </div>

                        <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">After Suhoor (Intention):</h4>
                            <div style="font-size: 1.3em; margin-bottom: 8px; direction: rtl;">${duas.suhoor.after.arabic}</div>
                            <div style="font-style: italic; color: #666; margin-bottom: 8px;">${duas.suhoor.after.transliteration}</div>
                            <div style="color: #333;">${duas.suhoor.after.english}</div>
                        </div>
                    `;
                }

                // Add Taraweeh dua
                duaHTML += `
                    <div style="margin-top: 25px; padding: 15px; background: white; border-radius: 10px; border: 2px solid #667eea;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">Dua of Taraweeh:</h4>
                        <div style="font-size: 1.3em; margin-bottom: 8px; direction: rtl;">${duas.taraweeh.arabic}</div>
                        <div style="font-style: italic; color: #666; margin-bottom: 8px;">${duas.taraweeh.transliteration}</div>
                        <div style="color: #333;">${duas.taraweeh.english}</div>
                    </div>
                `;

                duaDisplay.innerHTML = duaHTML;
                duaDisplay.style.display = 'block';
            } else {
                duaDisplay.style.display = 'none';
            }
        }

        // Export to Calendar
        function exportToCalendar() {
            const [hours, mins] = (currentMode === 'iftar' ? iftarTimeToday : suhoorTimeToday).split(':');

            let startDate, endDate, title, description;

            if (currentMode === 'iftar') {
                // Iftar: starts at iftar time, ends 30 minutes later
                startDate = new Date();
                startDate.setHours(parseInt(hours), parseInt(mins), 0, 0);
                endDate = new Date(startDate.getTime() + 30 * 60000); // 30 minutes later
                title = 'Iftar Time';
                description = `Break your fast at ${mosqueData.name}, ${mosqueData.city}`;
            } else {
                // Suhoor: starts 30 minutes before, ends at Fajr time (cutoff)
                endDate = new Date();
                endDate.setHours(parseInt(hours), parseInt(mins), 0, 0);
                startDate = new Date(endDate.getTime() - 30 * 60000); // 30 minutes before
                title = 'Suhoor Time';
                description = `Suhoor ends at ${formatTime(suhoorTimeToday)} (Fajr) at ${mosqueData.name}, ${mosqueData.city}`;
            }

            const location = `${mosqueData.name}, ${mosqueData.city}, CA`;

            // Format dates for iCal
            const formatDate = (date) => {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };

            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Iftar Countdown//EN
BEGIN:VEVENT
UID:${Date.now()}@iftar-countdown
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(startDate)}
DTEND:${formatDate(endDate)}
SUMMARY:${title}
DESCRIPTION:${description}
LOCATION:${location}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${title.toLowerCase().replace(' ', '-')}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Change Mosque
        function changeMosque() {
            const selectedMosque = document.getElementById('mosqueSelector').value;
            localStorage.setItem('selectedMosque', selectedMosque);
            location.reload();
        }

        // Change Language
        function changeLanguage() {
            const selectedLang = document.getElementById('langSelector').value;
            localStorage.setItem('selectedLanguage', selectedLang);
            location.reload();
        }

        // Initialize selectors
        document.getElementById('mosqueSelector').value = currentMosque;
        document.getElementById('langSelector').value = currentLang;
    </script>
</body>
</html>
